@model IEnumerable<Product>

<div class="row mt-4">
    @foreach (var item in Model)
    {
        <div class="item features-image сol-12 col-md-6 col-lg-4">
            <div class="item-wrapper">
                <div class="item-img">
                    <a asp-controller="Products" asp-action="Detail" asp-route-id="@item.Id">
                        <img src="@item.ImageUrl" alt="Coffee Shop" title="" style="cursor:pointer;" />
                    </a>
                </div>
                <div class="item-content">
                    <a asp-controller="Products" asp-action="Detail" asp-route-id="@item.Id">
                        <h6 class="item-subtitle mbr-fonts-style mt-1 display-7">
                            <strong>@item.Name</strong>
                        </h6>
                    </a>
                    <p class="mbr-text mbr-fonts-style mt-3 display-7">
                        @item.Price.ToString("c")
                    </p>
                </div>
                <div class="mbr-section-btn item-footer mt-2">
                    <button type="button" class="btn item-btn btn-primary display-4" onclick="addToCart(@item.Id)">
                        <span class="mbrib-cart-add mbr-iconfont mbr-iconfont-btn"></span>
                        Add to cart
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function addToCart(productId) {
            fetch('/ShoppingCart/AddToShoppingCart?pId=' + productId, {
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (document.getElementById('cartCount')) {
                        document.getElementById('cartCount').textContent = data.cartCount;
                    }
                    alert('Added to cart!');
                } else {
                    alert('Could not add to cart.');
                }
            });
        }
    </script>
}