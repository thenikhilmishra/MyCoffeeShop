@page
@model CoffeeShop.Pages.Admin.ManageProductsModel
@{
    ViewData["Title"] = "Manage Products";
}
<style>
    body, html {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    .manage-products-bg {
        background: url('/images/coffee-beans-2258839-960.jpg') center center no-repeat;
        background-attachment: fixed;
        background-size: cover;
        min-height: 100vh;
        width: 100vw;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .manage-products-card {
        max-width: 1100px;
        width: 100%;
        border-radius: 28px;
        box-shadow: 0 12px 40px rgba(44, 41, 92, 0.22);
        background: rgba(255,255,255,0.40);
        backdrop-filter: blur(24px);
        padding: 2.8rem 2.2rem 2.2rem 2.2rem;
        margin: 32px 0;
        border: 1.5px solid rgba(210,168,106,0.18);
        transition: box-shadow 0.2s;
    }
    .manage-products-header {
        color: #0a4d4d;
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: 1px;
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 2px 8px rgba(44,41,92,0.08);
    }
    .table {
        background: rgba(255,255,255,0.7);
        border-radius: 12px;
        overflow: hidden;
    }
    .btn-product {
        background: linear-gradient(90deg, #0fd6c9 0%, #ffb347 100%);
        color: #fff;
        font-weight: 700;
        border-radius: 10px;
        border: none;
        transition: background 0.2s, box-shadow 0.2s;
        font-size: 1rem;
        padding: 0.4rem 1.2rem;
        margin-right: 0.3rem;
        box-shadow: 0 2px 8px rgba(44, 41, 92, 0.08);
    }
    .btn-product:hover, .btn-product:focus {
        background: linear-gradient(90deg, #ffb347 0%, #0fd6c9 100%);
        color: #fff;
        box-shadow: 0 4px 16px rgba(44,41,92,0.12);
    }
    @@media (max-width: 900px) {
        .manage-products-card { max-width: 98vw; margin: 16px auto; padding: 1.2rem 0.5rem; }
        .manage-products-header { font-size: 1.5rem; }
    }
</style>
<div class="manage-products-bg">
    <div class="manage-products-card">

        <div class="manage-products-header">Manage Products</div>

        @* Show only one alert: success/info or validation errors *@
        @if (!ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger text-center">
                @foreach (var modelError in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <div>@modelError.ErrorMessage</div>
                }
            </div>
        }
        else if (!string.IsNullOrEmpty(Model.StatusMessage))
        {
            <div id="statusMessage" class="alert alert-success alert-dismissible fade show text-center" role="alert">
                @Model.StatusMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <form method="post" enctype="multipart/form-data" class="mb-5">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label asp-for="Product.Name" class="form-label"></label>
                    <input asp-for="Product.Name" class="form-control" />
                    <span asp-validation-for="Product.Name" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="Product.Price" class="form-label"></label>
                    <input asp-for="Product.Price" class="form-control" type="number" step="0.01" />
                    <span asp-validation-for="Product.Price" class="text-danger"></span>
                </div>
            </div>
            <div class="mb-3">
                <label asp-for="Product.Detail" class="form-label"></label>
                <textarea asp-for="Product.Detail" class="form-control" rows="3"></textarea>
                <span asp-validation-for="Product.Detail" class="text-danger"></span>
            </div>
            <div class="mb-3">
                <label asp-for="ImageFile" class="form-label">Product Image</label>
                <input asp-for="ImageFile" type="file" class="form-control" accept="image/*" onchange="previewProductImage(event)" />
                <span asp-validation-for="ImageFile" class="text-danger"></span>
                <div class="mt-2">
                    <img id="imagePreview" src="#" alt="Image Preview" style="max-width:180px; max-height:180px; display:none; border-radius:12px; box-shadow:0 2px 8px rgba(44,41,92,0.10);" />
                </div>
            </div>
            <div class="form-check mb-3">
                <input asp-for="Product.IsTrendingProduct" class="form-check-input" />
                <label asp-for="Product.IsTrendingProduct" class="form-check-label"></label>
            </div>
            <div class="d-flex justify-content-center gap-2">
                <button type="submit" class="btn btn-product">Add Product</button>
            </div>
        </form>

        <h3>Existing Products</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Detail</th>
                    <th>Price</th>
                    <th>Trending</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in Model.Products)
                {
                    <tr>
                        <td>@p.Name</td>
                        <td>@p.Detail</td>
                        <td>@p.Price</td>
                        <td>@(p.IsTrendingProduct ? "Yes" : "No")</td>
                        <td>
                            @if (!string.IsNullOrEmpty(p.ImageUrl))
                            {
                                <img src="@p.ImageUrl" alt="@p.Name" width="60" />
                            }
                        </td>
                        <td>
                            <a asp-page="EditProduct" asp-route-id="@p.Id" class="btn btn-sm btn-product">Edit</a>
                            <form method="post" asp-page-handler="Delete" asp-route-id="@p.Id" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                <button type="submit" class="btn btn-sm btn-product">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                var msg = document.getElementById('statusMessage');
                if (msg) {
                    msg.style.transition = "opacity 0.5s";
                    msg.style.opacity = 0;
                    setTimeout(function () { msg.style.display = 'none'; }, 500);
                }
            }, 2500);
        });
        function previewProductImage(event) {
            var input = event.target;
            var preview = document.getElementById('imagePreview');
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = '#';
                preview.style.display = 'none';
            }
        }
    </script>
}