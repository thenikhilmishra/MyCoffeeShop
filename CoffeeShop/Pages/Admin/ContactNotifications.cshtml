@page
@model CoffeeShop.Pages.Admin.ContactNotificationsModel
@{
    ViewData["Title"] = "Contact Notifications";
}
<style>
    .btn-send {
        background-color: #95eb34 !important;
        color: #222 !important;
        border: none;
    }
    .btn-send:hover, .btn-send:focus {
        background-color: #7fd62a !important;
        color: #111 !important;
    }
    .btn-markread {
        background-color: #34aeeb !important;
        color: #fff !important;
        border: none;
    }
    .btn-markread:hover, .btn-markread:focus {
        background-color: #228fc7 !important;
        color: #fff !important;
    }
    .btn-delete {
        background-color: #eb3477 !important;
        color: #fff !important;
        border: none;
    }
    .btn-delete:hover, .btn-delete:focus {
        background-color: #c71c5a !important;
        color: #fff !important;
    }
</style>
<div class="container mt-5">
    <h2>Contact Messages</h2>
    @if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div id="statusMessage" class="alert alert-success">@Model.StatusMessage</div>
    }
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Message</th>
                <th>Submitted At</th>
                <th>Status</th>
                <th>Reply</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var msg in Model.Messages)
        {
            <tr class="@(msg.IsRead ? "" : "table-warning")">
                <td>@msg.Name</td>
                <td>@msg.Email</td>
                <td>@msg.Phone</td>
                <td>@msg.Message</td>
                <td>@msg.SubmittedAt.ToLocalTime().ToString("g")</td>
                <td>@(msg.IsRead ? "Read" : "New")</td>
                <td>
                    @if (!string.IsNullOrEmpty(msg.AdminReply))
                    {
                        <span class="text-success">@msg.AdminReply</span>
                    }
                    else
                    {
                        <form method="post" asp-page-handler="Reply" class="d-flex">
                            <input type="hidden" name="id" value="@msg.Id" />
                            <input name="reply" class="form-control form-control-sm me-2" placeholder="Type reply..." />
                            <button type="submit" class="btn btn-sm btn-send">Send</button>
                        </form>
                    }
                </td>
                <td>
                    <form method="post" asp-page-handler="MarkRead" style="display:inline;">
                        <input type="hidden" name="id" value="@msg.Id" />
                        <button type="submit" class="btn btn-sm btn-markread" @(msg.IsRead ? "disabled" : "")>Mark as Read</button>
                    </form>
                    <form method="post" asp-page-handler="Delete" style="display:inline;">
                        <input type="hidden" name="id" value="@msg.Id" />
                        <button type="submit" class="btn btn-sm btn-delete">Delete</button>
                    </form>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>
@section Scripts {
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var msg = document.getElementById('statusMessage');
            if (msg) {
                setTimeout(function () {
                    msg.style.transition = "opacity 0.5s";
                    msg.style.opacity = 0;
                    setTimeout(function () { msg.style.display = 'none'; }, 500);
                }, 2000);
            }
        });
    </script>
}